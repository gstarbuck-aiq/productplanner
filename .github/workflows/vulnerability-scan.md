---
description: Scans third-party dependencies for High and Critical CVEs using the NIST NVD vulnerability database and generates a contextual assessment report as a GitHub issue.
on:
  schedule: daily on weekdays
permissions: read-all
tools:
  github:
    toolsets: [repos]
  web-fetch:
network:
  allowed: [services.nvd.nist.gov, nvd.nist.gov]
safe-outputs:
  create-issue:
    max: 1
    title-prefix: "[VulnScan] "
    labels: [security, vulnerability-report]
    close-older-issues: true
  noop: false
---

# Third-Party Dependency Vulnerability Scan

You are a security analyst. Your job is to scan this repository's third-party dependencies for known vulnerabilities in the NIST National Vulnerability Database (NVD), filtering for **High** and **Critical** severity CVEs only, and produce a contextual assessment report as a GitHub issue.

## Step 1: Detect Dependencies

Enumerate all dependency files in the repository. For each file found, extract every third-party dependency and its pinned version. Cover the following ecosystems:

- **Node.js**: `package.json` (fields: `dependencies`, `devDependencies`, `peerDependencies`), `package-lock.json`, `yarn.lock`, `pnpm-lock.yaml`
- **Python**: `requirements.txt`, `requirements*.txt`, `Pipfile.lock`, `pyproject.toml`, `uv.lock`, `setup.cfg`
- **Go**: `go.mod`, `go.sum`
- **Rust**: `Cargo.toml`, `Cargo.lock`
- **Java / Kotlin**: `pom.xml`, `build.gradle`, `build.gradle.kts`, `gradle/libs.versions.toml`
- **Ruby**: `Gemfile.lock`
- **.NET (C# / F#)**: `*.csproj`, `*.fsproj`, `packages.config` (look for `PackageReference` and `package` elements)
- **PHP**: `composer.lock`
- **Swift / Objective-C**: `Package.resolved`, `Podfile.lock`
- **Dart / Flutter**: `pubspec.lock`

If no dependency files are found anywhere in the repository, emit a `noop` output with the message: "No dependency files detected in this repository. Nothing to scan."

Build a deduplicated list of `{ name, version, ecosystem }` entries. If a version is unpinned (e.g., `*`, `>=1.0`, `latest`), record the version as-is and flag it for manual review in the final report.

## Step 2: Query the NVD CVE API v2.0

For each dependency, search the NVD for matching High and Critical CVEs. Use both severity levels in separate requests:

```
GET https://services.nvd.nist.gov/rest/json/cves/2.0?keywordSearch=<LIBRARY_NAME>&cvssV3Severity=HIGH&resultsPerPage=20
GET https://services.nvd.nist.gov/rest/json/cves/2.0?keywordSearch=<LIBRARY_NAME>&cvssV3Severity=CRITICAL&resultsPerPage=20
```

**API guidelines:**

- Use the package name as the keyword (e.g., `lodash`, `express`, `requests`, `log4j`).
- NVD allows approximately 5 unauthenticated requests per 30 seconds. Pace your requests accordingly.
- For each CVE returned, extract:
  - CVE ID (e.g., `CVE-2024-12345`)
  - CVSS v3 base score and severity label (`HIGH` or `CRITICAL`)
  - The vulnerable version ranges listed under `configurations` / `cpe:2.3` entries
  - The earliest patched version (look in the CVE description, references, or vendor advisories linked from the NVD page)
  - The NVD detail URL: `https://nvd.nist.gov/vuln/detail/<CVE-ID>`

**Inclusion criteria — only include a CVE if both conditions are met:**

1. CVSS v3 base score is **≥ 7.0** (severity is `HIGH` or `CRITICAL`).
2. The affected version range **includes** the version used in this repository. If the version range cannot be determined from the NVD response, include the CVE and note "version range unconfirmed" in the Assessment column.

Discard CVEs where the affected product clearly does not match (e.g., a CVE for `org.apache.logging.log4j:log4j-core` should not be attributed to an unrelated package with a similar keyword).

## Step 3: Assess Each Vulnerability

For each CVE that passes Step 2 filtering, perform a code-level contextual assessment:

1. **Read the import / usage sites**: Search the codebase for files that import or call the affected library. Look at how it is used — which functions or APIs are invoked.
2. **Understand the vulnerability**: Read the CVE description to identify the attack vector (Network, Adjacent, Local, Physical), attack complexity, required privileges, user interaction, and the vulnerable code path or feature.
3. **Evaluate exploitability in this implementation**:
   - Is the vulnerable feature / function actually exercised by this codebase?
   - Is user-controlled input ever passed to the vulnerable code path without sanitisation?
   - Is the service exposed to untrusted networks, or is it internal-only?
   - Are there application-level compensating controls (input validation, WAF, sandboxing)?
   - Does the deployment context meaningfully reduce the attack surface?

Write a **1–3 sentence assessment** for each CVE:

- **Not a risk**: Explain the specific reason (e.g., "The vulnerable `parseHTML()` function is never called in this codebase; only `parseText()` is used, which is not affected by this CVE.").
- **Risk present**: Clearly state that this is an active risk, describe the potential impact, and recommend remediation (e.g., upgrade to the fixed version).
- **Uncertain**: If you cannot fully determine exploitability, say so and recommend manual review.

## Step 4: Create the GitHub Issue Report

Create a GitHub issue with the following structure.

**Title format**: `[VulnScan] Dependency Vulnerability Report – <YYYY-MM-DD>`

**Body**:

Begin with a brief summary paragraph:

> Scanned **N** dependencies across **[list of ecosystems detected]** on **YYYY-MM-DD**. Found **X Critical** and **Y High** severity CVEs affecting **Z** libraries. **W** of these are assessed as active risks requiring remediation.

Then output the vulnerability table. Use exactly these columns in this order:

| Component/Library | Affected Version | Fixed Version | CVE Number | CVSS 3 Score | CVSS 3 Severity | Link to CVE at nvd.nist.gov | Assessment |
|---|---|---|---|---|---|---|---|
| `library-name` | `1.2.3` | `1.2.5` | CVE-2024-XXXXX | 9.8 | CRITICAL | [CVE-2024-XXXXX](https://nvd.nist.gov/vuln/detail/CVE-2024-XXXXX) | One to three sentence assessment. |

Column guidance:

- **Component/Library**: The package name exactly as it appears in the dependency file (use inline code formatting).
- **Affected Version**: The version pinned in this repository (use inline code formatting). If unpinned, use the recorded value and append ` ⚠️ unpinned`.
- **Fixed Version**: The earliest patched version, or `No fix available` if none exists.
- **CVE Number**: The CVE identifier (plain text, e.g., `CVE-2024-12345`).
- **CVSS 3 Score**: The numeric base score (e.g., `9.8`). Sort the table descending by this score.
- **CVSS 3 Severity**: `CRITICAL` or `HIGH` (all-caps).
- **Link to CVE at nvd.nist.gov**: A Markdown hyperlink using the CVE ID as the link text, pointing to `https://nvd.nist.gov/vuln/detail/<CVE-ID>`.
- **Assessment**: Your contextual assessment from Step 3.

Sort rows: Critical severity rows first (descending by score), then High severity rows (descending by score).

**If no High or Critical CVEs are found after scanning all dependencies:**

Still create an issue with the title `[VulnScan] Dependency Vulnerability Report – <YYYY-MM-DD>` and a body stating:

> No High or Critical severity CVEs were found across the **N** dependencies scanned on **YYYY-MM-DD**.
>
> Ecosystems scanned: [list]
> Dependencies checked: [comma-separated list of `name@version`]

## Step 5: Handle Edge Cases

- **NVD API unavailable or rate-limited**: If the API returns errors for a library, skip it, note it in the issue body under a "Scan Errors" section, and continue with remaining dependencies.
- **Ambiguous package names**: If a keyword search returns CVEs that clearly do not match the library (false positives from generic names), apply judgement to exclude them and note this in the Assessment column.
- **Unpinned versions**: Include applicable CVEs and note in Assessment: "Version is unpinned; any version in the affected range may be vulnerable. Pin to a fixed version ≥ X.Y.Z."
- **No source files to assess**: If the repository contains only dependency files and no application code, note in the Assessment: "No application source found; cannot assess exploitability. Treat as potentially at risk until code review is completed."
